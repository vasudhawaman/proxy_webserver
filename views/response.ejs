<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Site Safety Check</title>
</head>
<body>
  <h1>Protocol: <%= protocol %> <%= protocol === 'http' ? '(Not Secure)' : '(Secure)' %></h1>

  <h2>Google Safe Browsing:</h2>
  <p><%= googleApiResult === 'safe' ? 'No threats detected ✅' : 'Threat detected ❌' %></p>

  <h2>Security Header Score:</h2>
  <p><%= headerScore %>%</p>
  <p><strong>Header Analysis:</strong> <%= headerMessage %></p>

  <% if (missingHeaders && missingHeaders.length > 0) { %>
    <p><strong>Missing Headers:</strong></p>
    <ul>
      <% missingHeaders.forEach(header => { %>
        <li><%= header %></li>
      <% }); %>
    </ul>
  <% } else { %>
    <p><strong>All recommended headers are present.</strong></p>
  <% } %>

  <% if(sslTlsStatus && sslDetails) {%>
  <h2>SSL/TLS Status:</h2>
  <p><%= sslTlsStatus %></p>

  <% if (sslDetails && Object.keys(sslDetails).length > 0) { %>
    <h3>Certificate Details:</h3>
    <ul>
      <li><strong>Subject:</strong> <%= sslDetails.subject.CN || 'N/A' %></li>
      <li><strong>Issuer:</strong> <%= sslDetails.issuer.CN || 'N/A' %></li>
      <li><strong>Valid From:</strong> <%= sslDetails.valid_from %></li>
      <li><strong>Valid To:</strong> <%= sslDetails.valid_to %></li>
    </ul>
  <% } %>
  <% } %>
  
  <p>
    <a href="/">⬅ Back</a>
    &nbsp;&nbsp;
    <% if(visit) {%>
    <a href="<%= redirectTo %>?continue=true">Visit Website</a>
    <% } %>
  </p>
</body>
</html>
